<!DOCTYPE html>
<html>
<var></var>

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Free Web tutorials">
    <meta name="keywords" content="HTML, CSS, JavaScript">
    <meta name="author" content="Max Borglowe">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        p.sticky {
            text-align: center;
            margin-top: 15%;
            margin-left: auto;
            margin-right: auto;
        }

        .container {}

        .center {
            display: block;
            margin-top: 0%;
            margin-left: auto;
            margin-right: auto;
            max-width: 50%;
        }

        button {
            background-color: #ff9933;
            border: none;
            padding: 20px 10%;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
            margin-top: 1%;
            margin-left: auto;
            margin-right: auto;
        }

        p {
            color: white;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
            font-size: large;

        }
    </style>
</head>



<body onload="getCanvasDimensions(); drawBoard();" onresize="getCanvasDimensions()"
    style="background-color: rgb(36, 36, 36);">


    <p class="sticky" id="announcement"></p>
    <div class="container">
        <canvas class="center" id="gameCanvas" width="500" height="500" onmousemove="getMousePos(canvas, event)"
            onclick="placeShips(); incAmtPlayers();">
        </canvas>

        <button id="rotateButton" onclick="rotateShip();">rotate</button>
        <button id="toggleButton" onclick="toggleBoard();">toggle</button>

        <button id="ffaButton" onclick="startGame();">free-for-all</button>
        <button id="teamsButton" onclick="startGame();">teams</button>
    </div>

    <script>
        announceVar = "Set player amount";
        var rotateButton = document.getElementById("rotateButton");
        rotateButton.style.display = "none";

        var canvas = document.getElementById("gameCanvas");
        var ctx = canvas.getContext("2d");

        /* Canvas dimensions */
        var canWidth = canvas.width;
        var canHeight = canvas.height;
        var relCanWidth;    //relative to win size
        var relCanHeight;  //relative to win size
        /* Multipliers that keep track off initial window size */
        var winWidth = window.screen.width;
        var winHeight = window.screen.height;
        /* Board dimensions */
        var w = 10;
        var h = 10;
        /* Mouse coordinate variables */
        var mouseX;
        var mouseY;
        /* Board cell position where mouse is hovered on canvas */
        var boardPosX;
        var boardPosY;

        /* Game piece parameters */
        var pieceRadius = (canWidth / w) / 2 - canWidth * 0.02;
        var midOffset = (canWidth / w) / 2;
        var pieceColor;
        var prevPieceColor;
        /* Game variables */
        var setupMode = true; //during placement of ships
        var shipType = 0;
        var amtPiecesPerShip;
        var round = 0;
        var toggleVar = false;
        var amtPlayers = 2;
        var rotationVar = false;
        var currentPlayer = 0;
        var scoreString = "";
        var winner = false;
        var gameStarted = false;

        /* Create select board */
        var selectBoard = new Array(h);
        for (var i = 0; i < w; i++) {
            selectBoard[i] = new Array(w);
            for (var k = 0; k < h; k++) {
                selectBoard[i][k] = 0;
            }
        }

        /* Create ship matrices for each player with default values (0).
        friendlyBoard is where each player places their ships. shootBoard is where each
        player places their shots on the opponents friendlyBoard.
        ---Definitions:
        friendlyBoard: (0 default) = no placement, (1) = ship placed
        shootBoard: (0 default) = no placement, (1) = hit, (2) = miss */

        var friendlyBoard;
        var shootBoard;

        updateAmtPlayers();

        function updateAmtPlayers() {
            friendlyBoard = new Array(amtPlayers);
            shootBoard = new Array(amtPlayers);

            for (var p = 0; p < amtPlayers; p++) {
                friendlyBoard[p] = new Array(w);
                shootBoard[p] = new Array(w);
                for (var i = 0; i < w; i++) {
                    friendlyBoard[p][i] = new Array(h);
                    shootBoard[p][i] = new Array(h);
                    for (var k = 0; k < h; k++) {
                        friendlyBoard[p][i][k] = 0;
                        shootBoard[p][i][k] = 0;
                    }
                }
            }
        }



        /* Score board for each player */
        var scoreBoard = new Array(amtPlayers);
        scoreBoardZero();

        var ffaButton = document.getElementById("ffaButton");
        ffaButton.style.display = "block";
        var teamsButton = document.getElementById("teamsButton");
        teamsButton.style.display = "block";
        var rotateButton = document.getElementById("rotateButton");
        rotateButton.style.display = "none";
        var toggleButton = document.getElementById("toggleButton");
        toggleButton.style.display = "none";

        /* Get coordinates from where mouse hovers over canvas.
        This is used to determine whether mouse hovers over a certain
        circle on the board, which is then used to adress the correspondnig
        position in the different ship matrices */
        function getMousePos(canvas, e) {
            let rect = canvas.getBoundingClientRect();

            mouseX = e.clientX - rect.left;
            mouseY = e.clientY - rect.top;
            var coord = "mouse x: " + mouseX + " y: " + mouseY;
            // document.getElementById("coordPrint").innerHTML = coord;
            getBoardPos();
            selectFunc();
            drawBoard();
        }

        /* Get canvas width and height depending on the window size */
        function getCanvasDimensions() {
            relCanWidth = canvas.getBoundingClientRect().width;
            relCanHeight = canvas.getBoundingClientRect().height;
            var canvasDim = "canvas width: " + relCanWidth + " height:" + relCanHeight;
            // document.getElementById("canvasDimPrint").innerHTML = canvasDim;
        }

        /* Get the board cell position from where mouse hovers over canvas */
        function getBoardPos() {
            let cellWidth = relCanWidth / w;
            let cellHeight = relCanHeight / h;


            boardPosX = Math.floor(mouseX / cellWidth);
            boardPosY = Math.floor(mouseY / cellHeight);

            if (boardPosX < 0) {
                boardPosX = 0;
            }
            if (boardPosY < 0) {
                boardPosY = 0;
            }

            //var boardPos = "cell dim: " + cellWidth + " cell x: " + boardPosX + " cell y: " + boardPosY;
            //document.getElementById("boardPosPrint").innerHTML = boardPos;
        }

        /* Get the amount of game pieces that the current shipType consists of */
        function getShipPieces() {
            switch (shipType) {
                case 0: return 5;
                case 1: return 4;
                case 2: return 3;
                case 3: return 3;
                case 4: return 2;
            }
        }

        function scoreBoardZero() {
            for (var p = 0; p < amtPlayers; p++) {
                scoreBoard[p] = 0;
            }
        }

        /* Sets all coordinates on selectBoard to zero */
        function selectBoardZero() {
            for (var i = 0; i < w; i++) {
                for (var k = 0; k < h; k++) {
                    selectBoard[i][k] = 0;
                }
            }
        }

        function getPlayerColor() {

        }

        /* During setupMode: Get boardPosX/Y while making the ship stay inside the bounds
            of the canvas */
        function selectFunc() {
            if (gameStarted == true && winner == false) {
                selectBoardZero();

                if (setupMode == true) {
                    var amtPieces = getShipPieces();
                    var lastBoardPosX;
                    var lastBoardPosY;

                    if (rotationVar == false) {
                        for (var i = 0; i < amtPieces; i++) {
                            if (boardPosX + amtPieces <= w) {
                                selectBoard[boardPosX + i][boardPosY] = 1;
                                lastBoardPosX = boardPosX;
                                lastBoardPosY = boardPosY;
                            } else {
                                selectBoard[lastBoardPosX + i][lastBoardPosY] = 0;
                            }
                        }
                    } else {
                        for (var i = 0; i < amtPieces; i++) {
                            if (boardPosY + amtPieces <= h) {
                                selectBoard[boardPosX][boardPosY + i] = 1;
                                lastBoardPosX = boardPosX;
                                lastBoardPosY = boardPosY;
                            } else {
                                selectBoard[lastBoardPosX + i][lastBoardPosY] = 0;
                            }
                        }
                    }
                }
                else if (setupMode == false) {
                    selectBoard[boardPosX][boardPosY] = 1;
                }
            }
        }



        function printAnnouncement() {
            if (setupMode == true) {
                announceVar = "Place ships, ";
            }
            else if (setupMode == false) {
                announceVar = "";
            }
            announceVar += "player " + (getCurrentPlayer() + 1);

            if (gameStarted == true) {
                document.getElementById("scorePrint").innerHTML = scoreString;
                scoreString = "";
                for (let p = 0; p < amtPlayers; p++) {
                    scoreString += "\n player " + (p + 1) + " score: " + scoreBoard[p];
                }
            } else if (gameStarted == false) {
                announceVar = "Set player amount by clicking below";
            }
            document.getElementById("announcement").innerHTML = announceVar;
        }

        function getCurrentPlayer() {
            return currentPlayer;
        }

        function startGame() {
            gameStarted = true;
            ffaButton.style.display = "none";
            teamsButton.style.display = "none";
            rotateButton.style.display = "block";
            scoreBoardZero();
            selectBoardZero();
            drawBoard();
        }


        /* During setupMode = true lets player rotate the current shipType */
        function rotateShip() {
            rotationVar = !rotationVar;
        }

        /* Toggle between player's friendly and enemy board view */
        function toggleBoard() {
            toggleVar = !toggleVar;
            drawBoard();
        }

        function incAmtPlayers() {
            if (gameStarted == false) {
                amtPlayers = (amtPlayers + 1) % 5;
                if (amtPlayers < 2) {
                    amtPlayers = 2;
                }
                drawBoard();
                updateAmtPlayers();
            }

        }

        /* Place ships on corresponding players friendlyBoard. The position of each ship's pieces
        positions are determined by the current state of selectBoard */
        function placeShips() {
            if (gameStarted == true) {
                /* Ship placement phase */
                var boundsCheck = 0;

                if (setupMode == true) {
                    toggleVar = false;
                    if (currentPlayer < amtPlayers) {
                        if (shipType < 5) {
                            for (var i = 0; i < w; i++) {
                                for (var k = 0; k < h; k++) {
                                    if (selectBoard[i][k] == 1 && friendlyBoard[currentPlayer][i][k] == 0) {
                                        boundsCheck++;
                                    }
                                }
                            }
                            if (boundsCheck >= getShipPieces()) {
                                for (var i = 0; i < w; i++) {
                                    for (var k = 0; k < h; k++) {
                                        if (selectBoard[i][k] == 1 && friendlyBoard[currentPlayer][i][k] == 0) {
                                            friendlyBoard[currentPlayer][i][k] = 1;
                                        }
                                    }
                                }
                                shipType++;
                            }
                        }
                    }

                    if (shipType >= 5) {
                        currentPlayer++;
                        shipType = 0;
                    }

                    if (currentPlayer >= amtPlayers) {
                        setupMode = false;
                        currentPlayer = 0;
                        shipType = "none";
                        toggleButton.style.display = "block";
                        rotateButton.style.display = "none";
                        selectBoardZero();
                    }
                    getShipType();
                }

                /* Shooting phase */
                if (setupMode == false) {
                    toggleVar = true;
                    var legalShot = false;
                    if (selectBoard[boardPosX][boardPosY] == 1 && shootBoard[currentPlayer][boardPosX][boardPosY] == 0) {
                        legalShot = true;
                    }

                    if (legalShot == true) {
                        if (friendlyBoard[(currentPlayer + 1) % amtPlayers][boardPosX][boardPosY] == 1) {
                            /* Hit */
                            announceVar = "Hit!";
                            shootBoard[currentPlayer][boardPosX][boardPosY] = 1;
                        } else {
                            /* Miss */
                            announceVar = "Miss!";
                            shootBoard[currentPlayer][boardPosX][boardPosY] = 2;
                        }
                    }
                }
                if (legalShot == true) {
                    incCurrentPlayer();
                    printAnnouncement();
                }
                drawBoard();
            }
        }


        function incCurrentPlayer() {
            currentPlayer = (currentPlayer + 1) % amtPlayers;
        }

        /* get current shipType number */
        function getShipType() {
            // document.getElementById("shipTypePrint").innerHTML = "shipType: " + shipType + " setupMode: " + setupMode
            //  + " currentPlayer: " + currentPlayer;
            return shipType;
        }

        function drawPlayerAmtNbr() {
            if (gameStarted == false) {
                selectBoardZero();
                if (amtPlayers == 2) {
                    for (let i = 0; i < 2; i++) {
                        for (let k = 0; k < 2; k++) {
                            selectBoard[i + 6][k + 2] = 1;
                            selectBoard[i + 2][k + 6] = 1;
                        }
                    }

                    for (let f = 0; f < 3; f++) {
                        for (let i = 0; i < 6; i++) {
                            for (let k = 0; k < 2; k++) {
                                selectBoard[i + 2][k + f * 4] = 1;
                            }
                        }
                    }
                } else if (amtPlayers == 3) {
                    for (let f = 0; f < 2; f++) {
                        for (let i = 0; i < 2; i++) {
                            for (let k = 0; k < 2; k++) {
                                selectBoard[i + 6][k + 2 + f * 4] = 1;
                            }
                        }
                    }

                    for (let f = 0; f < 3; f++) {
                        for (let i = 0; i < 6; i++) {
                            for (let k = 0; k < 2; k++) {
                                selectBoard[i + 2][k + f * 4] = 1;
                            }
                        }
                    }
                } else if (amtPlayers == 4) {
                    for (let i = 0; i < 2; i++) {
                        for (let k = 0; k < h; k++) {
                            selectBoard[i + 6][k] = 1;
                            if (k < 6) {
                                selectBoard[i + 2][k] = 1;
                                if (k >= 4) {
                                    selectBoard[i + 4][k] = 1;
                                }
                            }
                        }
                    }
                }
            }
        }

        /* Draws board. If a matrix is input, the board will draw blue dots that represent
            ones in specified matrix.*/
        function drawBoard() {
            let rectWidth = canWidth / w;
            let rectHeight = canHeight / h;
            scoreBoard[currentPlayer] = 0;

            drawPlayerAmtNbr();

            for (let i = 0; i < w; i++) {
                for (let k = 0; k < h; k++) {
                    let x = (i * canWidth / w + midOffset);
                    let y = (k * canHeight / h + midOffset);

                    pieceColor = document.body.style.backgroundColor;
                    if (gameStarted == true) {
                        pieceColor = "#ff9933"; //orange
                    }

                    if (selectBoard[i][k] == 1) {
                        if (gameStarted == true) {
                            pieceColor = "#0099ff"; //blue
                        } else {
                            pieceColor = "#ff9933"; //orange
                        }
                    }

                    if (toggleVar == false) {
                        /* Piece alive */
                        if (friendlyBoard[currentPlayer][i][k] == 1) {
                            pieceColor = "#33cc33"; //green
                            /* Piece dead */
                            if (shootBoard[(currentPlayer + 1) % amtPlayers][i][k] == 1) {
                                pieceColor = "#ff3300"; //red
                            }
                        }
                        else if (friendlyBoard[currentPlayer][i][k] == 0) {
                        }
                    }
                    else if (toggleVar == true) {
                        /* Hit */
                        if (shootBoard[currentPlayer][i][k] == 1) {
                            scoreBoard[currentPlayer]++;
                            pieceColor = "#ff3300"; //red
                        }
                        /* Miss */
                        else if (shootBoard[currentPlayer][i][k] == 2) {
                            pieceColor = document.body.style.backgroundColor; //blend with bg
                        }
                    }

                    ctx.fillStyle = pieceColor;
                    ctx.beginPath();
                    ctx.arc(x, y, pieceRadius, 0, 2 * Math.PI);
                    ctx.fill();
                }
            }

            if (scoreBoard[currentPlayer] == 17) {
                winner = true;
                announceVar = "player " + (currentPlayer + 1) + " wins!";
            }

            printAnnouncement();

            if (winner == true) {
                gameStarted = false;
            }
            document.getElementById("demo").innerHTML = "gamestart: " + gameStarted + " winner " + winner + " crtPlayer " + currentPlayer;
        }
    </script>

    <p class="sticky" style="margin-top: 2%;" id="scorePrint"></p>
    <p id="demo"></p>

</body>

</html>